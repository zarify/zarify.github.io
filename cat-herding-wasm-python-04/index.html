<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>WASM Python - Cat Herding 04 | Headtilt</title>
<meta name="keywords" content="ai, python, llm, agents, cat-herding, wasm-python">
<meta name="description" content="Pre(r)amble
This is part of a(n aspirationally) series of posts documenting some of the process of
(building|cat herding an AI agent to build)
an easily hosted Python teaching tool built with just front-end JS and a WASM port of
MicroPython.

You can find Part 1 here
You can find Part 2 here
You can find Part 3 here
This is Part 4!
You can find Part 5 here
You can find Part 6 here

What we had before
See last week&rsquo;s post for
some of the details and screenshots.">
<meta name="author" content="Rob">
<link rel="canonical" href="https://headtilt.me/cat-herding-wasm-python-04/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.1d79e034ed3fae3cce466e1b13b697315f9998d1ba8d908def178611b372b49f.css" integrity="sha256-HXngNO0/rjzORm4bE7aXMV&#43;ZmNG6jZCN7xeGEbNytJ8=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://headtilt.me/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://headtilt.me/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://headtilt.me/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://headtilt.me/apple-touch-icon.png">
<link rel="mask-icon" href="https://headtilt.me/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="https://headtilt.me/cat-herding-wasm-python-04/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><script src="https://kit.fontawesome.com/3ec5c52433.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/formatting.css">



</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://headtilt.me/" accesskey="h" title="Adjust your angle (Alt + H)">
                <img src="https://headtilt.me/images/headtilt.png" alt="" aria-label="logo"
                    height="30">Adjust your angle</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://headtilt.me/post" title="posts">
                    <span><i class="fa-solid fa-pen-to-square"></i> posts</span>
                </a>
            </li>
            <li>
                <a href="https://headtilt.me/page/about/" title="about">
                    <span><i class="fa-solid fa-circle-info"></i> about</span>
                </a>
            </li>
            <li>
                <a href="https://headtilt.me/categories/" title="categories">
                    <span><i class="fa-solid fa-layer-group"></i> categories</span>
                </a>
            </li>
            <li>
                <a href="https://headtilt.me/tags/" title="tags">
                    <span><i class="fa-solid fa-tags"></i> tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      WASM Python - Cat Herding 04
    </h1>
    <div class="post-meta"><span title='2025-09-13 05:58:07 +0800 AWST'>Sat, Sep 13, 2025</span>&nbsp;Â·&nbsp;Rob

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#preramble" aria-label="Pre(r)amble">Pre(r)amble</a></li>
                <li>
                    <a href="#what-we-had-before" aria-label="What we had before">What we had before</a></li>
                <li>
                    <a href="#whats-happened-since" aria-label="What&rsquo;s happened since">What&rsquo;s happened since</a><ul>
                        
                <li>
                    <a href="#student-verification-codes" aria-label="Student verification codes">Student verification codes</a></li>
                <li>
                    <a href="#authoring-improvements" aria-label="Authoring improvements">Authoring improvements</a></li>
                <li>
                    <a href="#read-only-file-support" aria-label="Read-only file support">Read-only file support</a></li>
                <li>
                    <a href="#micropythons-edges" aria-label="Micropython&rsquo;s edges">Micropython&rsquo;s edges</a></li></ul>
                </li>
                <li>
                    <a href="#aintrospection" aria-label="(A)Introspection">(A)Introspection</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="preramble">Pre(r)amble<a hidden class="anchor" aria-hidden="true" href="#preramble">#</a></h2>
<p>This is part of a(n aspirationally) series of posts documenting some of the process of
(building|cat herding an AI agent to build)
an easily hosted Python teaching tool built with just front-end JS and a WASM port of
MicroPython.</p>
<ul>
<li><a href="https://headtilt.me/cat-herding-wasm-python-01/">You can find Part 1 here</a></li>
<li><a href="https://headtilt.me/cat-herding-wasm-python-02/">You can find Part 2 here</a></li>
<li><a href="https://headtilt.me/cat-herding-wasm-python-03/">You can find Part 3 here</a></li>
<li>This is Part 4!</li>
<li><a href="https://headtilt.me/cat-herding-wasm-python-05/">You can find Part 5 here</a></li>
<li><a href="https://headtilt.me/cat-herding-wasm-python-06/">You can find Part 6 here</a></li>
</ul>
<h2 id="what-we-had-before">What we had before<a hidden class="anchor" aria-hidden="true" href="#what-we-had-before">#</a></h2>
<p>See <a href="https://headtilt.me/cat-herding-wasm-python-03/">last week&rsquo;s post</a> for
some of the details and screenshots.</p>
<ul>
<li>AST feedback and tests with an authoring tool for building some customisable rules</li>
<li>Test groups and run conditions for groups and individual tests</li>
<li>Activity indicator on the feedback tab</li>
</ul>
<h2 id="whats-happened-since">What&rsquo;s happened since<a hidden class="anchor" aria-hidden="true" href="#whats-happened-since">#</a></h2>
<p>Here are some screenshots of the latest version with some of the new features.</p>
<style>
    .image-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 1%;
        margin-left: -1% !important;
    }

    .image-gallery li {
        list-style: none;
        width: 19%;
        display: flex;
        flex-direction: column;
    }

    .image-gallery li a {
        text-align: center;
        text-decoration: none !important;
        color: #777;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        justify-content: space-between;
        box-shadow: none !important;
    }

    .image-gallery li a span {
        display: block;
        padding: 3px 0;
        white-space: normal;
        font-size: 0.8em;
    }

    .image-gallery li a img {
        width: 100%;
        display: block;
    }

     
    @media (max-width: 1200px) {
        .image-gallery li {
            width: 24%;
             
        }
    }

    @media (max-width: 992px) {
        .image-gallery li {
            width: 32%;
             
        }
    }

    @media (max-width: 768px) {
        .image-gallery li {
            width: 49%;
             
        }
    }

    @media (max-width: 576px) {
        .image-gallery li {
            width: 100%;
             
        }
    }
</style>


<ul class="image-gallery">
    <li>
        <a href="/gallery/clipy/week4/01_verification_authoring.png" title="01_verification_authoring" class="lightbox-image">
            <img src="/gallery/clipy/week4/01_verification_authoring.png" alt="01_verification_authoring" title="01_verification_authoring">
            <span>01_verification_authoring</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/02_verification_user.png" title="02_verification_user" class="lightbox-image">
            <img src="/gallery/clipy/week4/02_verification_user.png" alt="02_verification_user" title="02_verification_user">
            <span>02_verification_user</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/03_read_only_author.png" title="03_read_only_author" class="lightbox-image">
            <img src="/gallery/clipy/week4/03_read_only_author.png" alt="03_read_only_author" title="03_read_only_author">
            <span>03_read_only_author</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/04_read_only_user.png" title="04_read_only_user" class="lightbox-image">
            <img src="/gallery/clipy/week4/04_read_only_user.png" alt="04_read_only_user" title="04_read_only_user">
            <span>04_read_only_user</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/05_remove_protected_file.png" title="05_remove_protected_file" class="lightbox-image">
            <img src="/gallery/clipy/week4/05_remove_protected_file.png" alt="05_remove_protected_file" title="05_remove_protected_file">
            <span>05_remove_protected_file</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/06_write_to_read_only.png" title="06_write_to_read_only" class="lightbox-image">
            <img src="/gallery/clipy/week4/06_write_to_read_only.png" alt="06_write_to_read_only" title="06_write_to_read_only">
            <span>06_write_to_read_only</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/07_ast_rule_interface.png" title="07_ast_rule_interface" class="lightbox-image">
            <img src="/gallery/clipy/week4/07_ast_rule_interface.png" alt="07_ast_rule_interface" title="07_ast_rule_interface">
            <span>07_ast_rule_interface</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/08_ast_truthy_warning.png" title="08_ast_truthy_warning" class="lightbox-image">
            <img src="/gallery/clipy/week4/08_ast_truthy_warning.png" alt="08_ast_truthy_warning" title="08_ast_truthy_warning">
            <span>08_ast_truthy_warning</span>
        </a>
    </li>
    <li>
        <a href="/gallery/clipy/week4/09_ast_syntax_warning.png" title="09_ast_syntax_warning" class="lightbox-image">
            <img src="/gallery/clipy/week4/09_ast_syntax_warning.png" alt="09_ast_syntax_warning" title="09_ast_syntax_warning">
            <span>09_ast_syntax_warning</span>
        </a>
    </li>
    
</ul>
<h3 id="student-verification-codes">Student verification codes<a hidden class="anchor" aria-hidden="true" href="#student-verification-codes">#</a></h3>
<p>Although this is designed to be a tool predominately used by students, I&rsquo;m a teacher,
and having some feedback from students about whether they have successfully completed
a problem scenario is a nice to have. But how do we do this in an environment specifically
designed to not require any server infrastructure?</p>
<p>The answer is obviously hashing! So I added an optional student identifier to the UI, and
when all the tests have been passed, if there is an identifier present, the student gets
presented with a human-speakable code (two words and a number) that is built from a hash
of the test suite, the day they ran the tests, and their student identifier.</p>
<p>In the authoring interface, the teacher can enter any number of student identifiers, and
will be shown the current verification codes for the problem config that has been loaded.
This obviously doesn&rsquo;t give the teacher any idea of <em>how</em> the student has solved the
problem, but it&rsquo;s a lightweight first step in a conversation.</p>
<h3 id="authoring-improvements">Authoring improvements<a hidden class="anchor" aria-hidden="true" href="#authoring-improvements">#</a></h3>
<p>There were a few improvements to the authoring page this week, mostly focused on making
tests and feedback easier to author and more flexible.</p>
<ul>
<li>AST rules now have some light syntax checking of the rules, so will present an error
and prevent saving if the expression is invalid or only <em>truthy</em> rather than a true boolean</li>
<li>Additional files can be added to tests that override the user workspace, so allow for
checks against hard-coded results of file use problems</li>
<li>An option for partial or full string matches in feedback and tests was added to make
it easier to write more flexible or strict feedback and test rules</li>
</ul>
<h3 id="read-only-file-support">Read-only file support<a hidden class="anchor" aria-hidden="true" href="#read-only-file-support">#</a></h3>
<p>I added support for read-only (protected) files into the user workspace and wow did the
agent ever have a hard time with this one. Files can be marked as <em>read-only</em> in authoring
which both prevents the user from writing to them and also prevents deletion through the UI
as well as with user code.</p>
<p>This is where I really started to run into some of the issues with using a client-side
approach using Micropython. The two bundled ideas in this feature were file permissions
and file ownership, both wrapped in a virtual filesystem bundle, trying to isolate
authorship and userland code all on the user&rsquo;s device.</p>

            <link rel="stylesheet" href="/css/vendors/admonitions.4fd9a0b8ec8899f2ca952048d255a569f433f77dfb3f52f5bc87e7d65cdce449.css" integrity="sha256-T9mguOyImfLKlSBI0lWlafQz9337P1L1vIfn1lzc5Ek=" crossorigin="anonymous">
    <div class="admonition danger">
      <div class="admonition-header"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M256 32c14.2 0 27.3 7.5 34.5 19.8l216 368c7.3 12.4 7.3 27.7 .2 40.1S486.3 480 472 480L40 480c-14.3 0-27.6-7.7-34.7-20.1s-7-27.8 .2-40.1l216-368C228.7 39.5 241.8 32 256 32zm0 128c-13.3 0-24 10.7-24 24l0 112c0 13.3 10.7 24 24 24s24-10.7 24-24l0-112c0-13.3-10.7-24-24-24zm32 224a32 32 0 1 0 -64 0 32 32 0 1 0 64 0z"/></svg>
        <span>Rabbit holes ahoy!</span>
      </div>
      <div class="admonition-content">
        <p>This feature came with another exciting rabbit hole. When I was testing whether files had
actually been deleted (reconciling the tabbed file UI with the virtual filesystem that
Micropython accesses) I ran into an issue where an <code>os.listdir()</code> was taking <strong>7 seconds</strong>
to run. It turns out the agent had added a boatload of system tracing into the code and
so something simple like &ldquo;what are the files please?&rdquo; turned into an insane mess of checks
and conditional console output.</p>
      </div>
    </div><h3 id="micropythons-edges">Micropython&rsquo;s edges<a hidden class="anchor" aria-hidden="true" href="#micropythons-edges">#</a></h3>
<p>As I write more testing code, and put the (hopefully final) set of features into user
workspaces and the authoring interface, it&rsquo;s starting to become apparent where the hard
edges are in using Micropython instead of something like Pyodide.</p>
<p>Error handling is something that Micropython does a bit differently. It doesn&rsquo;t come
with the lovely expansive tracebacks of regular Python (that&rsquo;s been improved so much in
the last couple of major versions), and so there&rsquo;s a bit of a divergence between what
the student would see running their code in this app vs in a desktop version when things
go wrong.</p>

    <div class="admonition idea">
      <div class="admonition-header"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/></svg>
        <span>Python or Programming?</span>
      </div>
      <div class="admonition-content">
        <p>Part of me wonders how much this is an actual problem however. As a teacher who has used
Python for over 15 years now, particularly in days of yore when the popular programming
languages in schools tended to be things like Visual Basic, I often think about whether
it matters if we&rsquo;re &ldquo;teaching Python&rdquo; or &ldquo;teaching programming&rdquo;, particularly as features
like the walrus operator come out that have the potential to change the way we think
about how control flow is written in the language.</p>
      </div>
    </div><p>The other edge I&rsquo;m starting to run into as I build out a library of test configurations
is modules and the standard library. A really common library to use with students is CSV.
There are lots of examples of CSV data out there, and it&rsquo;s convenient to export from
spreadsheets and then use with code. However, CSV isn&rsquo;t part of the Micropython stdlib.</p>
<p>This wouldn&rsquo;t be such a problem if CSV wasn&rsquo;t such a hot mess in terms of edge cases
and we could do simple parsing, but sadly that isn&rsquo;t the case.</p>

    <div class="admonition idea">
      <div class="admonition-header"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><path d="M272 384c9.6-31.9 29.5-59.1 49.2-86.2c0 0 0 0 0 0c5.2-7.1 10.4-14.2 15.4-21.4c19.8-28.5 31.4-63 31.4-100.3C368 78.8 289.2 0 192 0S16 78.8 16 176c0 37.3 11.6 71.9 31.4 100.3c5 7.2 10.2 14.3 15.4 21.4c0 0 0 0 0 0c19.8 27.1 39.7 54.4 49.2 86.2l160 0zM192 512c44.2 0 80-35.8 80-80l0-16-160 0 0 16c0 44.2 35.8 80 80 80zM112 176c0 8.8-7.2 16-16 16s-16-7.2-16-16c0-61.9 50.1-112 112-112c8.8 0 16 7.2 16 16s-7.2 16-16 16c-44.2 0-80 35.8-80 80z"/></svg>
        <span>Pyodide?</span>
      </div>
      <div class="admonition-content">
        <p>I&rsquo;m squinting at Pyodide and starting to wonder how much more involved it will be
building the same sort of support for the async JS-based workflow I&rsquo;ve got going
here with Micropython, or whether there&rsquo;s a better solution with full-fat Python.
(Ideally a better solution that doesn&rsquo;t involve completely rewriting the whole app!)</p>
      </div>
    </div><h2 id="aintrospection">(A)Introspection<a hidden class="anchor" aria-hidden="true" href="#aintrospection">#</a></h2>
<p>Back when I started this project everything was being written into one big <code>main.js</code>
file. Even after the first couple of working features appeared, this grew into something
like 3000 lines of JS, and this was the point where it became really obvious that
unless it got split out into feature-based files it would be completely unmaintainable
(particularly for the agent, which has really struggled with larger files).</p>
<p>Since then, I&rsquo;ve been watching each of the modules getting bigger and bigger. Doing
the refactor of the main file was horrible, and had a couple of false starts while I
figured out a way of getting the agent to tackle the problem in a good way that didn&rsquo;t
get it stuck.</p>
<p>I&rsquo;m peeking around my fingers at a time in the not-too-distant future when I&rsquo;m going
to start paying attention to just what is in those modules, since I got a bit of a
look when trying to get to the bottom of the issues with the read-only file feature
this week, and the amount of duplicate code, debugging code that&rsquo;s been gated behind
flags, etc. Slimming things down once things are &ldquo;complete&rdquo; is going to be a ride.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://headtilt.me/tags/ai/">Ai</a></li>
      <li><a href="https://headtilt.me/tags/python/">Python</a></li>
      <li><a href="https://headtilt.me/tags/llm/">Llm</a></li>
      <li><a href="https://headtilt.me/tags/agents/">Agents</a></li>
      <li><a href="https://headtilt.me/tags/cat-herding/">Cat-Herding</a></li>
      <li><a href="https://headtilt.me/tags/wasm-python/">Wasm-Python</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>Rob Poulter</span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script type="text/javascript" src="/js/lightbox.js"></script>
<link rel="stylesheet" href="/css/lightbox.css">
<script data-goatcounter="https://headtilt_me.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
