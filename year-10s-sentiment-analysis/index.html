<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Year 10s: Sentiment Analysis | Headtilt</title>
<meta name="keywords" content="compsci, datascience">
<meta name="description" content="In 2019 I started up a programming-oriented Data Science class with my Year 10s. I ran two classes during the year, each spanning a semester. My aim for the course was to introduce students to different ways of storing, retrieving, and working with data, as well as give some coverage over different types of data and some operations that you can perform with it (e.g. numeric, text, spatial).
I ran a different main project with each class: during the first semester I looked at analysing data from the Australian Federal Government Hansard. Unfortunately, the students in the group weren&rsquo;t very interested in it, and (like many of my first time projects) the scope turned out to be overly broad, meaning students had trouble figuring out what they would do from all the alternatives of what they could do. Tangentially, working with the XML from the Hansard is a great (or terrible, depending on your perspective) activity in data cleaning - they&rsquo;ve made some&hellip; interesting decisions about how to format their data inside the XML structure.">
<meta name="author" content="Rob">
<link rel="canonical" href="/year-10s-sentiment-analysis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="/year-10s-sentiment-analysis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><script src="https://kit.fontawesome.com/3ec5c52433.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/formatting.css"><meta property="og:url" content="/year-10s-sentiment-analysis/">
  <meta property="og:site_name" content="Headtilt">
  <meta property="og:title" content="Year 10s: Sentiment Analysis">
  <meta property="og:description" content="In 2019 I started up a programming-oriented Data Science class with my Year 10s. I ran two classes during the year, each spanning a semester. My aim for the course was to introduce students to different ways of storing, retrieving, and working with data, as well as give some coverage over different types of data and some operations that you can perform with it (e.g. numeric, text, spatial).
I ran a different main project with each class: during the first semester I looked at analysing data from the Australian Federal Government Hansard. Unfortunately, the students in the group weren’t very interested in it, and (like many of my first time projects) the scope turned out to be overly broad, meaning students had trouble figuring out what they would do from all the alternatives of what they could do. Tangentially, working with the XML from the Hansard is a great (or terrible, depending on your perspective) activity in data cleaning - they’ve made some… interesting decisions about how to format their data inside the XML structure.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-12-29T15:46:19+00:00">
    <meta property="article:modified_time" content="2019-12-29T15:46:19+00:00">
    <meta property="article:tag" content="Compsci">
    <meta property="article:tag" content="Datascience">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Year 10s: Sentiment Analysis">
<meta name="twitter:description" content="In 2019 I started up a programming-oriented Data Science class with my Year 10s. I ran two classes during the year, each spanning a semester. My aim for the course was to introduce students to different ways of storing, retrieving, and working with data, as well as give some coverage over different types of data and some operations that you can perform with it (e.g. numeric, text, spatial).
I ran a different main project with each class: during the first semester I looked at analysing data from the Australian Federal Government Hansard. Unfortunately, the students in the group weren&rsquo;t very interested in it, and (like many of my first time projects) the scope turned out to be overly broad, meaning students had trouble figuring out what they would do from all the alternatives of what they could do. Tangentially, working with the XML from the Hansard is a great (or terrible, depending on your perspective) activity in data cleaning - they&rsquo;ve made some&hellip; interesting decisions about how to format their data inside the XML structure.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Year 10s: Sentiment Analysis",
      "item": "/year-10s-sentiment-analysis/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Year 10s: Sentiment Analysis",
  "name": "Year 10s: Sentiment Analysis",
  "description": "In 2019 I started up a programming-oriented Data Science class with my Year 10s. I ran two classes during the year, each spanning a semester. My aim for the course was to introduce students to different ways of storing, retrieving, and working with data, as well as give some coverage over different types of data and some operations that you can perform with it (e.g. numeric, text, spatial).\nI ran a different main project with each class: during the first semester I looked at analysing data from the Australian Federal Government Hansard. Unfortunately, the students in the group weren\u0026rsquo;t very interested in it, and (like many of my first time projects) the scope turned out to be overly broad, meaning students had trouble figuring out what they would do from all the alternatives of what they could do. Tangentially, working with the XML from the Hansard is a great (or terrible, depending on your perspective) activity in data cleaning - they\u0026rsquo;ve made some\u0026hellip; interesting decisions about how to format their data inside the XML structure.\n",
  "keywords": [
    "compsci", "datascience"
  ],
  "articleBody": "In 2019 I started up a programming-oriented Data Science class with my Year 10s. I ran two classes during the year, each spanning a semester. My aim for the course was to introduce students to different ways of storing, retrieving, and working with data, as well as give some coverage over different types of data and some operations that you can perform with it (e.g. numeric, text, spatial).\nI ran a different main project with each class: during the first semester I looked at analysing data from the Australian Federal Government Hansard. Unfortunately, the students in the group weren’t very interested in it, and (like many of my first time projects) the scope turned out to be overly broad, meaning students had trouble figuring out what they would do from all the alternatives of what they could do. Tangentially, working with the XML from the Hansard is a great (or terrible, depending on your perspective) activity in data cleaning - they’ve made some… interesting decisions about how to format their data inside the XML structure.\nThe second project was processing text to determine sentiment. This worked a lot better, and the project had a nice natural flow from the basic concepts of tokenisation and weighting, to some concepts like stop words, before throwing in some (large) real world data sets to test out our algorithm. It’s worthwhile noting here that it is very naive, and only gauges positive or negative sentiment, with no other categorisation like angry, sad, etc.\nProgression of Sentiment Analysis We start out by looking at some very basic examples and developing an algorithm. This might be some identification of simple tokens, or to start with just ordering the sentences from most positive to most negative and articulating what differentiates each sentence from its neighbours.\nDuring the ranking process it becomes apparent that not all sentiment tokens are created equal, and so some sort of weighting system should come into play, meaning we can develop a scoring algorithm which we can apply to each sentence. I threw in a couple of ambiguous cases so that we also had to think about things like modifier words and symbols (e.g. ’not’ coming before a sentiment token, shouty caps, or exclamation marks). This is where we can start bringing in how to tackle programming the algorithm and process the simple sentences to see how it fares and whether or not the results match our expectations discussed at the start of the project. This is as simple as initialising a score variable, splitting the sentence on spaces, and normalising by stripping punctuation and changing to a standard case (typically lower). We can then examine each word, checking for membership in our lists of sentiment tokens (in class we grouped them to v_bad, bad, good, and v_good with anything not being in these lists not contributing to the score.\nThis worked pretty well with the sample sentences, but it was obvious that it did not deal with modifiers at all, so “not good” was counted as a positive sentiment in the same way that “good” was. In the previous code snippet, the enumerate function was used to get the position of each word in the sentence along with the word itself, so that we could examine the preceding word as well. This had the added benefit of being able to check for amplifying words like “very” at the same time. Modifying or inverting was simply a case of adding to, subtracting from, or multiplying (e.g. x2 for a boost, or x -1 for an inversion) the score for the current word.\nFrom here we looked at the importance of stop words. For example our modifier words were sometimes separated by stop words, such as in one of the examples “but not in a good way”. Filtering out any stop words prior to analysis and weighting made it possible to invert or amplify words which were not next to each other, but still related. This list of stop words we used can be found here: http://xpo6.com/list-of-english-stop-words/\nscore = 0 words = s.split() words = [w for w in words if w.lower().strip(punctuation) not in stopwords] for pos, word in enumerate(words): mod = 1 if word.isupper(): mod += 0.5 word = word.lower().strip(punctuation) if pos != 0: if words[pos-1].lower().strip(punctuation) in mods: mod += 0.25 if words[pos-1].lower().strip(punctuation) in inverters: mod *= -1 if word in v_good: score += 2 * mod elif word in good: score += 1 * mod elif word in v_bad: score -= 2 * mod elif word in bad: score -= 1 * mod An extract of the code showing the implementation of the scoring algorithm.\nOnce we played with the values to get to the point where we were happy with the (somewhat arbitrary) scores, all that was left to do was try it out with some real world data.\nThe University of Pittsburgh Mult-Question Perspective Answering site has a few interesting sets of data for download, and we grabbed a copy of the Subjectivity Lexicon (which is available for free, but you need to supply contact details), and split it up for use in our program. This gave use a huge list of words, along with a strong or weak associate with positive or negative use (and more practice splitting strings in Python :).\ntype=strongsubj len=1 word1=abomination pos1=noun stemmed1=n priorpolarity=negative type=weaksubj len=1 word1=above pos1=anypos stemmed1=n priorpolarity=positive type=weaksubj len=1 word1=above-average pos1=adj stemmed1=n priorpolarity=positive type=weaksubj len=1 word1=abound pos1=verb stemmed1=y priorpolarity=positive type=weaksubj len=1 word1=abrade pos1=verb stemmed1=y priorpolarity=negative type=strongsubj len=1 word1=abrasive pos1=adj stemmed1=n priorpolarity=negative A sample of the University of Pittsburgh data. We only used the type, word1, and priorpolarity key value pairs.\nIn retrospect one of their other data sets might have been more suitable, but this was the one I found initially and didn’t bother exploring the others since it seemed good enough in the time I had available to investigate. Lastly we needed some real world data which we could use to compare our results, and to stop using our toy data set of contrived sentences. Since the initial premise for the program was analysis of product reviews, what better place to look than Amazon. I found a set of Amazon reviews that had been collected for analysis by Jianmo Ni from the University of California San Diego. Unlike the previous sets of data, this was nicely formatted as JSON, and there was a large range of different review categories, all of which were suitably huge (definitely from a student perspective, used to dealing with tens of data points). As the smallest set was more than enough for our purposes, I chose the Amazon Instant Video category, weighing in at a mere 37126 entries.\n{\"reviewerID\": \"A11N155CW1UV02\", \"asin\": \"B000H00VBQ\", \"reviewerName\": \"AdrianaM\", \"helpful\": [0, 0], \"reviewText\": \"I had big expectations because I love English TV, in particular Investigative and detective stuff but this guy is really boring. It didn't appeal to me at all.\", \"overall\": 2.0, \"summary\": \"A little bit boring for me\", \"unixReviewTime\": 1399075200, \"reviewTime\": \"05 3, 2014\"} {\"reviewerID\": \"A3BC8O2KCL29V2\", \"asin\": \"B000H00VBQ\", \"reviewerName\": \"Carol T\", \"helpful\": [0, 0], \"reviewText\": \"I highly recommend this series. It is a must for anyone who is yearning to watch \\\"grown up\\\" television. Complex characters and plots to keep one totally involved. Thank you Amazin Prime.\", \"overall\": 5.0, \"summary\": \"Excellent Grown Up TV\", \"unixReviewTime\": 1346630400, \"reviewTime\": \"09 3, 2012\"} {\"reviewerID\": \"A60D5HQFOTSOM\", \"asin\": \"B000H00VBQ\", \"reviewerName\": \"Daniel Cooper \\\"dancoopermedia\\\"\", \"helpful\": [0, 1], \"reviewText\": \"This one is a real snoozer. Don't believe anything you read or hear, it's awful. I had no idea what the title means. Neither will you.\", \"overall\": 1.0, \"summary\": \"Way too boring for me\", \"unixReviewTime\": 1381881600, \"reviewTime\": \"10 16, 2013\"} A sample of the Amazon Instant Video data. “overall” gives the star rating, and we also looked at the “reviewText” field. It would be interesting to see how useful the “helpful” data was in the future too.\nWorking with JSON let us look at working with libraries (although we had done some work with CSV prior to this) and the dictionary data structure.\nOne of the great things about this data set, is that whilst we could analyse the review text and see how our algorithm scored each one, each review also contained the star rating given by the reviewer, which meant that we could compare the implicit review sentiment based on the text to the explicit review rating and use this as a method for determining either the honesty of the review, or as a metric for evaluating the accuracy of our algorithm.\nWe ended up running out of time to do the final analysis, but I’ll manage our time better next time I run with this project. I put together a quick program of the work we did in class comparing the extremes of sentiment scores to star ratings, which turned out to be 73% accurate. Not too bad for a toy program that simplifies the problem quite a lot!\nWhat worked and what didn’t As far as engagement goes, I think this worked really well - students followed the flow most of the way and I think the complexity of the main ideas were about right. Splitting, scoring, stop words, iterating through a list of words: all of these worked out fine.\nWhere things tended to fall apart a bit is when we got to importing the larger files. Even though the sentiment words and the JSON reviews were quite simple as individual entries, somehow the idea of processing tens of thousands of them was a bit intimidating.\nI was originally going to do an activity looking at identifying online chat behaviour, being inspired by this tweet from Karsten Schulz (although taking a different approach). I ended up being put off by the difficulty of finding good sample data to work with that was real world but fairly tame. I might have another crack at it later on and maybe incorporate it into an IRC bot or something similar.\nSome final code Although we ran out of time in class, I put together a bit of code which compares Amazon review star ratings with calculated sentiment and tries to figure out how accurate the simple scoring algorithm is. It isn’t quite finished, but I doubt that will change for a while.\nfrom string import punctuation from stopwords import stops from math import floor from json import loads sentiment_words = {} # word: strength, +ve -ve numbers for polarity with open(\"subjclues.txt\") as f: line = f.readline().strip(\"\\n\") while line: pairs = line.split(\" \") # 0, 2, -1 polarity_type = pairs[0].split(\"=\")[1] word = pairs[2].split(\"=\")[1] strength = pairs[-1].split(\"=\")[1] mod = 1 if strength == \"negative\": mod *= -1 if polarity_type == \"strongsubj\": mod *= 2 sentiment_words[word] = mod line = f.readline().strip(\"\\n\") # customise good/bad for context def add_word(word, weight): if word not in sentiment_words: sentiment_words[word] = weight else: print(f\"Warning: {word} is already in word list with weighting {sentiment_words[word]}.\") def remove_word(word): if word in sentiment_words: del sentiment_words[word] else: print(f\"Warning: {word} not found in word list.\") # e.g. 'buy' is a good word for product reviews add_word(\"buy\", 1) remove_word(\"really\") remove_word(\"incredibly\") remove_word(\"very\") remove_word(\"just\") remove_word(\"super\") mods = [\"really\", \"incredibly\", \"very\", \"super\"] inverters = [\"not\", \"isn't\"] def analyse(s): score = 0 # break the sentence up into a list of individual words words = s.split() #print(f\"Analysing: {s}\") # filter out stop words by recreating the list only adding words # which are not in the stop word list # this list comes from http://xpo6.com/list-of-english-stop-words/ words = [w for w in words if w.lower().strip(punctuation) not in stops] # enumerate gives us position, value pairs for lists # pos will store for pos, word in enumerate(words): # This changes the weighting of a sentiment word mod = 1 if word.isupper(): mod += 0.5 word = word.lower().strip(punctuation) # check if the previous word is a modifier word # this should really pay attention to things like sentence endings, but we'll # leave that for a later version if pos != 0: # not the very first word, since that has no previous word prev = words[pos-1].lower().strip(punctuation) if prev in mods: mod += 0.25 elif prev in inverters: mod *= -1 if word in sentiment_words: score += sentiment_words[word] * mod #print(f\"\\t{word} - {sentiment_words[word]} * {mod}\") # Global sentence modifiers. These change the weighting of the whole # sentence, not just the individual words. if s[-1] == \"!\": score *= 1.5 #print(\"\\tExclamation! - * 1.5\") if s.isupper(): score *= 1.25 #print(\"\\tShouty CAPS - * 1.25\") #print(f\"\\tScore: {score}\") return score with open(\"Amazon_Instant_Video_5.json\") as f: line = f.readline() matches = 0 total = 0 # collect and graph sentiment scores scores = [] while line: review = loads(line) score = analyse(review[\"reviewText\"]) scores.append(score) overall = review[\"overall\"] # check if negative sentiment matches poor overall (1-2 -ve, 3 neutral, 4-5 +ve) if (score \u003c 0 and overall \u003c 3) or (score \u003e 0 and overall \u003e 3): matches += 1 elif score == 0 and overall == 3: matches += 1 else: pass #print(f\"Mismatch score {score} vs rating {overall}\") total += 1 line = f.readline() print(f\"\\nSummary:\\n\\tTotal reviews: {total}\\n\\tTotal matches: {matches}\\n\\tMatch %: {int(matches / total * 100)}\") print(f\"\\nScore max: {max(scores)}\\nScore min: {min(scores)}\") score_range = max(scores) - min(scores) increments = int(score_range / 20) # something arbitrary for histogram buckets buckets = [0]*20 for score in scores: bucket = floor(score/increments) buckets[bucket] += 1 mins = int(min(scores)) for i, bucket in enumerate(buckets): perc = int(bucket / total * 100) / 2 b = i * increments + mins print(f\"{b:5} to {b + mins - 1:5} \" + \"*\" * int(perc)) ",
  "wordCount" : "2244",
  "inLanguage": "en",
  "datePublished": "2019-12-29T15:46:19.959Z",
  "dateModified": "2019-12-29T15:46:19.959Z",
  "author":{
    "@type": "Person",
    "name": "Rob"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/year-10s-sentiment-analysis/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Headtilt",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Adjust your angle (Alt + H)">
                <img src="/images/headtilt.png" alt="" aria-label="logo"
                    height="30">Adjust your angle</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/post" title="posts">
                    <span><i class="fa-solid fa-pen-to-square"></i> posts</span>
                </a>
            </li>
            <li>
                <a href="/page/about/" title="about">
                    <span><i class="fa-solid fa-circle-info"></i> about</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="categories">
                    <span><i class="fa-solid fa-layer-group"></i> categories</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="tags">
                    <span><i class="fa-solid fa-tags"></i> tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Year 10s: Sentiment Analysis
    </h1>
    <div class="post-meta"><span title='2019-12-29 15:46:19.959 +0000 UTC'>Sun, Dec 29, 2019</span>&nbsp;·&nbsp;Rob

</div>
  </header> 
  <div class="post-content"><p>In 2019 I started up a programming-oriented Data Science class with my Year 10s. I ran two classes during the year, each spanning a semester. My aim for the course was to introduce students to different ways of storing, retrieving, and working with data, as well as give some coverage over different types of data and some operations that you can perform with it (e.g. numeric, text, spatial).</p>
<p>I ran a different main project with each class: during the first semester I looked at analysing data from the <a href="https://www.aph.gov.au/Parliamentary_Business/Hansard">Australian Federal Government Hansard</a>. Unfortunately, the students in the group weren&rsquo;t very interested in it, and (like many of my first time projects) the scope turned out to be overly broad, meaning students had trouble figuring out what they <em>would</em> do from all the alternatives of what they <em>could</em> do. Tangentially, working with the XML from the Hansard is a great (or terrible, depending on your perspective) activity in data cleaning - they&rsquo;ve made some&hellip; interesting decisions about how to format their data inside the XML structure.</p>
<img loading="lazy" src="/images/1_hansard_snip.png"><p>The second project was processing text to determine sentiment. This worked a lot better, and the project had a nice natural flow from the basic concepts of <a href="https://en.wikipedia.org/wiki/Lexical_analysis#Tokenization">tokenisation</a> and weighting, to some concepts like <a href="https://en.wikipedia.org/wiki/Stop_words">stop words</a>, before throwing in some (large) real world data sets to test out our algorithm. It&rsquo;s worthwhile noting here that it is <em>very</em> naive, and only gauges positive or negative sentiment, with no other categorisation like angry, sad, etc.</p>
<h2 id="progression-of-sentiment-analysis">Progression of Sentiment Analysis<a hidden class="anchor" aria-hidden="true" href="#progression-of-sentiment-analysis">#</a></h2>
<img loading="lazy" src="/images/2_sentiment_samples.png"><p>We start out by looking at some very basic examples and developing an algorithm. This might be some identification of simple tokens, or to start with just ordering the sentences from most positive to most negative and articulating what differentiates each sentence from its neighbours.</p>
<p>During the ranking process it becomes apparent that not all sentiment tokens are created equal, and so some sort of weighting system should come into play, meaning we can develop a scoring algorithm which we can apply to each sentence. I threw in a couple of ambiguous cases so that we also had to think about things like modifier words and symbols (e.g. &rsquo;not&rsquo; coming before a sentiment token, shouty caps, or exclamation marks). </p>
<p>This is where we can start bringing in how to tackle programming the algorithm and process the simple sentences to see how it fares and whether or not the results match our expectations discussed at the start of the project. This is as simple as initialising a score variable, splitting the sentence on spaces, and normalising by stripping punctuation and changing to a standard case (typically lower). We can then examine each word, checking for membership in our lists of sentiment tokens (in class we grouped them to <strong>v_bad</strong>, <strong>bad</strong>, <strong>good</strong>, and <strong>v_good</strong> with anything not being in these lists not contributing to the score.</p>
<p>This worked pretty well with the sample sentences, but it was obvious that it did not deal with modifiers at all, so &ldquo;not good&rdquo; was counted as a positive sentiment in the same way that &ldquo;good&rdquo; was. In the previous code snippet, the enumerate function was used to get the position of each word in the sentence along with the word itself, so that we could examine the preceding word as well. This had the added benefit of being able to check for amplifying words like &ldquo;very&rdquo; at the same time. Modifying or inverting was simply a case of adding to, subtracting from, or multiplying (e.g. x2 for a boost, or x -1 for an inversion) the score for the current word.</p>
<p>From here we looked at the importance of stop words. For example our modifier words were sometimes separated by stop words, such as in one of the examples &ldquo;but <strong>not</strong> in a <strong>good</strong> way&rdquo;. Filtering out any stop words prior to analysis and weighting made it possible to invert or amplify words which were not next to each other, but still related. This list of stop words we used can be found here: <a href="http://xpo6.com/list-of-english-stop-words/">http://xpo6.com/list-of-english-stop-words/</a></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl"><span class="n">words</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stopwords</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">mod</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">mod</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">    <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">mod</span> <span class="o">+=</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">words</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="ow">in</span> <span class="n">inverters</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">mod</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">v_good</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mod</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">good</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">+=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">mod</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">v_bad</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">-=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mod</span>
</span></span><span class="line"><span class="cl">    <span class="k">elif</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">bad</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">-=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">mod</span>
</span></span></code></pre></div><p>An extract of the code showing the implementation of the scoring algorithm.</p>
<p>Once we played with the values to get to the point where we were happy with the (somewhat arbitrary) scores, all that was left to do was try it out with some real world data.</p>
<p>The <a href="http://mpqa.cs.pitt.edu">University of Pittsburgh Mult-Question Perspective Answering</a> site has a few interesting sets of data for download, and we grabbed a copy of the <a href="http://mpqa.cs.pitt.edu/lexicons/subj_lexicon/">Subjectivity Lexicon</a> (which is available for free, but you need to supply contact details), and split it up for use in our program. This gave use a huge list of words, along with a strong or weak associate with positive or negative use (and more practice splitting strings in Python :).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">type=strongsubj len=1 word1=abomination pos1=noun stemmed1=n priorpolarity=negative
</span></span><span class="line"><span class="cl">type=weaksubj len=1 word1=above pos1=anypos stemmed1=n priorpolarity=positive
</span></span><span class="line"><span class="cl">type=weaksubj len=1 word1=above-average pos1=adj stemmed1=n priorpolarity=positive
</span></span><span class="line"><span class="cl">type=weaksubj len=1 word1=abound pos1=verb stemmed1=y priorpolarity=positive
</span></span><span class="line"><span class="cl">type=weaksubj len=1 word1=abrade pos1=verb stemmed1=y priorpolarity=negative
</span></span><span class="line"><span class="cl">type=strongsubj len=1 word1=abrasive pos1=adj stemmed1=n priorpolarity=negative
</span></span></code></pre></div><p>A sample of the University of Pittsburgh data. We only used the <strong>type</strong>, <strong>word1</strong>, and <strong>priorpolarity</strong> key value pairs.</p>
<div class="callout callout-warning">
    <i class="fa-solid fa-asterisk"></i>
    <div class="callout-content">
        In retrospect one of their other data sets might have been more suitable, but this was the one I found initially and didn&rsquo;t bother exploring the others since it seemed good enough in the time I had available to investigate.
    </div>
</div>

<style>
    .callout {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        display: flex;
        align-items: center;
        font-family: 'Arial', sans-serif;
        font-size: 0.9em;
    }

    .callout-warning {
        background-color: #fff3cd;
        border-color: #ffeeba;
    }

    .callout i {
        margin-right: 10px;
        padding: 0.25em 0.5em;
        font-size: 1.5em;
    }

    .callout-content {
        flex-grow: 1;
    }
</style>
<p>Lastly we needed some real world data which we could use to compare our results, and to stop using our toy data set of contrived sentences. Since the initial premise for the program was analysis of product reviews, what better place to look than Amazon. I found a set of <a href="https://nijianmo.github.io/amazon/index.html">Amazon reviews that had been collected</a> for analysis by Jianmo Ni from the University of California San Diego. Unlike the previous sets of data, this was nicely formatted as JSON, and there was a large range of different review categories, all of which were suitably huge (definitely from a student perspective, used to dealing with tens of data points). As the smallest set was more than enough for our purposes, I chose the Amazon Instant Video category, weighing in at a mere 37126 entries.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;reviewerID&#34;</span><span class="p">:</span> <span class="s2">&#34;A11N155CW1UV02&#34;</span><span class="p">,</span> <span class="nt">&#34;asin&#34;</span><span class="p">:</span> <span class="s2">&#34;B000H00VBQ&#34;</span><span class="p">,</span> <span class="nt">&#34;reviewerName&#34;</span><span class="p">:</span> <span class="s2">&#34;AdrianaM&#34;</span><span class="p">,</span> <span class="nt">&#34;helpful&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nt">&#34;reviewText&#34;</span><span class="p">:</span> <span class="s2">&#34;I had big expectations because I love English TV, in particular Investigative and detective stuff but this guy is really boring. It didn&#39;t appeal to me at all.&#34;</span><span class="p">,</span> <span class="nt">&#34;overall&#34;</span><span class="p">:</span> <span class="mf">2.0</span><span class="p">,</span> <span class="nt">&#34;summary&#34;</span><span class="p">:</span> <span class="s2">&#34;A little bit boring for me&#34;</span><span class="p">,</span> <span class="nt">&#34;unixReviewTime&#34;</span><span class="p">:</span> <span class="mi">1399075200</span><span class="p">,</span> <span class="nt">&#34;reviewTime&#34;</span><span class="p">:</span> <span class="s2">&#34;05 3, 2014&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;reviewerID&#34;</span><span class="p">:</span> <span class="s2">&#34;A3BC8O2KCL29V2&#34;</span><span class="p">,</span> <span class="nt">&#34;asin&#34;</span><span class="p">:</span> <span class="s2">&#34;B000H00VBQ&#34;</span><span class="p">,</span> <span class="nt">&#34;reviewerName&#34;</span><span class="p">:</span> <span class="s2">&#34;Carol T&#34;</span><span class="p">,</span> <span class="nt">&#34;helpful&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="nt">&#34;reviewText&#34;</span><span class="p">:</span> <span class="s2">&#34;I highly recommend this series. It is a must for anyone who is yearning to watch \&#34;grown up\&#34; television. Complex characters and plots to keep one totally involved. Thank you Amazin Prime.&#34;</span><span class="p">,</span> <span class="nt">&#34;overall&#34;</span><span class="p">:</span> <span class="mf">5.0</span><span class="p">,</span> <span class="nt">&#34;summary&#34;</span><span class="p">:</span> <span class="s2">&#34;Excellent Grown Up TV&#34;</span><span class="p">,</span> <span class="nt">&#34;unixReviewTime&#34;</span><span class="p">:</span> <span class="mi">1346630400</span><span class="p">,</span> <span class="nt">&#34;reviewTime&#34;</span><span class="p">:</span> <span class="s2">&#34;09 3, 2012&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span><span class="nt">&#34;reviewerID&#34;</span><span class="p">:</span> <span class="s2">&#34;A60D5HQFOTSOM&#34;</span><span class="p">,</span> <span class="nt">&#34;asin&#34;</span><span class="p">:</span> <span class="s2">&#34;B000H00VBQ&#34;</span><span class="p">,</span> <span class="nt">&#34;reviewerName&#34;</span><span class="p">:</span> <span class="s2">&#34;Daniel Cooper \&#34;dancoopermedia\&#34;&#34;</span><span class="p">,</span> <span class="nt">&#34;helpful&#34;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="nt">&#34;reviewText&#34;</span><span class="p">:</span> <span class="s2">&#34;This one is a real snoozer. Don&#39;t believe anything you read or hear, it&#39;s awful. I had no idea what the title means. Neither will you.&#34;</span><span class="p">,</span> <span class="nt">&#34;overall&#34;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">,</span> <span class="nt">&#34;summary&#34;</span><span class="p">:</span> <span class="s2">&#34;Way too boring for me&#34;</span><span class="p">,</span> <span class="nt">&#34;unixReviewTime&#34;</span><span class="p">:</span> <span class="mi">1381881600</span><span class="p">,</span> <span class="nt">&#34;reviewTime&#34;</span><span class="p">:</span> <span class="s2">&#34;10 16, 2013&#34;</span><span class="p">}</span>
</span></span></code></pre></div><p> A sample of the Amazon Instant Video data. &ldquo;<strong>overall</strong>&rdquo; gives the star rating, and we also looked at the &ldquo;<strong>reviewText</strong>&rdquo; field. It would be interesting to see how useful the &ldquo;<strong>helpful</strong>&rdquo; data was in the future too.</p>
<p> Working with JSON let us look at working with libraries (although we had done some work with CSV prior to this) and the dictionary data structure.</p>
<p>One of the great things about this data set, is that whilst we could analyse the review text and see how our algorithm scored each one, each review also contained the star rating given by the reviewer, which meant that we could compare the implicit review sentiment based on the text to the explicit review rating and use this as a method for determining either the honesty of the review, or as a metric for evaluating the accuracy of our algorithm.</p>
<p>We ended up running out of time to do the final analysis, but I&rsquo;ll manage our time better next time I run with this project. I put together a quick program of the work we did in class comparing the extremes of sentiment scores to star ratings, which turned out to be 73% accurate. Not too bad for a toy program that simplifies the problem quite a lot!</p>
<h2 id="what-worked-and-what-didnt">What worked and what didn&rsquo;t<a hidden class="anchor" aria-hidden="true" href="#what-worked-and-what-didnt">#</a></h2>
<p>As far as engagement goes, I think this worked really well - students followed the flow most of the way and I think the complexity of the main ideas were about right. Splitting, scoring, stop words, iterating through a list of words: all of these worked out fine.</p>
<p>Where things tended to fall apart a bit is when we got to importing the larger files. Even though the sentiment words and the JSON reviews were quite simple as individual entries, somehow the idea of processing tens of thousands of them was a bit intimidating.</p>
<img loading="lazy" src="/images/sentiment_tweet.png"><p>I was originally going to do an activity looking at identifying online chat behaviour, being inspired by <a href="https://twitter.com/DigTecInstitute/status/1163971165527785472">this tweet</a> from <a href="https://twitter.com/kkschulz">Karsten Schulz</a> (although taking a different approach). I ended up being put off by the difficulty of finding good sample data to work with that was real world but fairly tame. I might have another crack at it later on and maybe incorporate it into an IRC bot or something similar.</p>
<h2 id="some-final-code">Some final code<a hidden class="anchor" aria-hidden="true" href="#some-final-code">#</a></h2>
<p>Although we ran out of time in class, I put together a bit of code which compares Amazon review star ratings with calculated sentiment and tries to figure out how accurate the simple scoring algorithm is. It isn&rsquo;t quite finished, but I doubt that will change for a while.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">string</span> <span class="kn">import</span> <span class="n">punctuation</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">stopwords</span> <span class="kn">import</span> <span class="n">stops</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">floor</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">json</span> <span class="kn">import</span> <span class="n">loads</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">sentiment_words</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1"># word: strength, +ve -ve numbers for polarity</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;subjclues.txt&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">pairs</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># 0, 2, -1</span>
</span></span><span class="line"><span class="cl">        <span class="n">polarity_type</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">word</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">strength</span> <span class="o">=</span> <span class="n">pairs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&#34;=&#34;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">mod</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">strength</span> <span class="o">==</span> <span class="s2">&#34;negative&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">mod</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">polarity_type</span> <span class="o">==</span> <span class="s2">&#34;strongsubj&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">mod</span> <span class="o">*=</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="n">sentiment_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">mod</span>
</span></span><span class="line"><span class="cl">        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># customise good/bad for context</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">add_word</span><span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">word</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">sentiment_words</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">sentiment_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">weight</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Warning: </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2"> is already in word list with weighting </span><span class="si">{</span><span class="n">sentiment_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="si">}</span><span class="s2">.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">remove_word</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentiment_words</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">del</span> <span class="n">sentiment_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;Warning: </span><span class="si">{</span><span class="n">word</span><span class="si">}</span><span class="s2"> not found in word list.&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># e.g. &#39;buy&#39; is a good word for product reviews</span>
</span></span><span class="line"><span class="cl"><span class="n">add_word</span><span class="p">(</span><span class="s2">&#34;buy&#34;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">remove_word</span><span class="p">(</span><span class="s2">&#34;really&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">remove_word</span><span class="p">(</span><span class="s2">&#34;incredibly&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">remove_word</span><span class="p">(</span><span class="s2">&#34;very&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">remove_word</span><span class="p">(</span><span class="s2">&#34;just&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">remove_word</span><span class="p">(</span><span class="s2">&#34;super&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">mods</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;really&#34;</span><span class="p">,</span> <span class="s2">&#34;incredibly&#34;</span><span class="p">,</span> <span class="s2">&#34;very&#34;</span><span class="p">,</span> <span class="s2">&#34;super&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="n">inverters</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&#34;not&#34;</span><span class="p">,</span> <span class="s2">&#34;isn&#39;t&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">analyse</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">score</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># break the sentence up into a list of individual words</span>
</span></span><span class="line"><span class="cl">    <span class="n">words</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#print(f&#34;Analysing: {s}&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># filter out stop words by recreating the list only adding words</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># which are not in the stop word list</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># this list comes from http://xpo6.com/list-of-english-stop-words/</span>
</span></span><span class="line"><span class="cl">    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span> <span class="k">if</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">stops</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># enumerate gives us position, value pairs for lists</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># pos will store</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">pos</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># This changes the weighting of a sentiment word</span>
</span></span><span class="line"><span class="cl">        <span class="n">mod</span> <span class="o">=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">word</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">            <span class="n">mod</span> <span class="o">+=</span> <span class="mf">0.5</span>
</span></span><span class="line"><span class="cl">        <span class="n">word</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># check if the previous word is a modifier word</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># this should really pay attention to things like sentence endings, but we&#39;ll</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># leave that for a later version</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="c1"># not the very first word, since that has no previous word</span>
</span></span><span class="line"><span class="cl">            <span class="n">prev</span> <span class="o">=</span> <span class="n">words</span><span class="p">[</span><span class="n">pos</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="n">punctuation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">prev</span> <span class="ow">in</span> <span class="n">mods</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mod</span> <span class="o">+=</span> <span class="mf">0.25</span>
</span></span><span class="line"><span class="cl">            <span class="k">elif</span> <span class="n">prev</span> <span class="ow">in</span> <span class="n">inverters</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">mod</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sentiment_words</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">score</span> <span class="o">+=</span> <span class="n">sentiment_words</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">*</span> <span class="n">mod</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#print(f&#34;\t{word} - {sentiment_words[word]} * {mod}&#34;)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Global sentence modifiers. These change the weighting of the whole</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># sentence, not just the individual words.</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&#34;!&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">*=</span> <span class="mf">1.5</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#print(&#34;\tExclamation! - * 1.5&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">s</span><span class="o">.</span><span class="n">isupper</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">*=</span> <span class="mf">1.25</span>
</span></span><span class="line"><span class="cl">        <span class="c1">#print(&#34;\tShouty CAPS - * 1.25&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#print(f&#34;\tScore: {score}&#34;)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">score</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;Amazon_Instant_Video_5.json&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">matches</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># collect and graph sentiment scores</span>
</span></span><span class="line"><span class="cl">    <span class="n">scores</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="n">line</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">review</span> <span class="o">=</span> <span class="n">loads</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">score</span> <span class="o">=</span> <span class="n">analyse</span><span class="p">(</span><span class="n">review</span><span class="p">[</span><span class="s2">&#34;reviewText&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">scores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">score</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">overall</span> <span class="o">=</span> <span class="n">review</span><span class="p">[</span><span class="s2">&#34;overall&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># check if negative sentiment matches poor overall (1-2 -ve, 3 neutral, 4-5 +ve)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">score</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">overall</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">score</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">overall</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">elif</span> <span class="n">score</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">overall</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">matches</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">pass</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#print(f&#34;Mismatch score {score} vs rating {overall}&#34;)</span>
</span></span><span class="line"><span class="cl">        <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="n">line</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Summary:</span><span class="se">\n\t</span><span class="s2">Total reviews: </span><span class="si">{</span><span class="n">total</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">Total matches: </span><span class="si">{</span><span class="n">matches</span><span class="si">}</span><span class="se">\n\t</span><span class="s2">Match %: </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">matches</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Score max: </span><span class="si">{</span><span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">}</span><span class="se">\n</span><span class="s2">Score min: </span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">score_range</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span> <span class="o">-</span> <span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">increments</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">score_range</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span> <span class="c1"># something arbitrary for histogram buckets</span>
</span></span><span class="line"><span class="cl">    <span class="n">buckets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">20</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">score</span> <span class="ow">in</span> <span class="n">scores</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">bucket</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="n">score</span><span class="o">/</span><span class="n">increments</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">buckets</span><span class="p">[</span><span class="n">bucket</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">mins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">scores</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">bucket</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">buckets</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">perc</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">bucket</span> <span class="o">/</span> <span class="n">total</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="n">b</span> <span class="o">=</span> <span class="n">i</span> <span class="o">*</span> <span class="n">increments</span> <span class="o">+</span> <span class="n">mins</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">b</span> <span class="o">+</span> <span class="n">mins</span> <span class="o">-</span> <span class="mi">1</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> &#34;</span> <span class="o">+</span> <span class="s2">&#34;*&#34;</span> <span class="o">*</span> <span class="nb">int</span><span class="p">(</span><span class="n">perc</span><span class="p">))</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/compsci/">Compsci</a></li>
      <li><a href="/tags/datascience/">Datascience</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>Rob Poulter</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script type="text/javascript" src="/js/lightbox.js"></script>
<link rel="stylesheet" href="/css/lightbox.css">
<script data-goatcounter="https://headtilt_me.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
