<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Dowsing for Radio | Headtilt</title>
<meta name="keywords" content="microbit">
<meta name="description" content="Motivation
This term I&rsquo;ve been working through Data Representation and some Networks concepts with my Year 8 students. I used Micro:bits extensively for both aspects of this for the hands-on approach and ready access to simple networking code. To finish off the term, after looking at things like network latency, I thought it&rsquo;d be fun to do an activity built around attenuation of wireless signals.
Previously I&rsquo;ve had students group up in pairs and have the Micro:bits send an image back and forth pixel by pixel. This allows for students to see when messages have not arrived as they will have missing pixels from their displays.">
<meta name="author" content="Rob">
<link rel="canonical" href="/dowsing-for-radio/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="mask-icon" href="/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="/dowsing-for-radio/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript><script src="https://kit.fontawesome.com/3ec5c52433.js" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/css/formatting.css"><meta property="og:url" content="/dowsing-for-radio/">
  <meta property="og:site_name" content="Headtilt">
  <meta property="og:title" content="Dowsing for Radio">
  <meta property="og:description" content="Motivation This term I’ve been working through Data Representation and some Networks concepts with my Year 8 students. I used Micro:bits extensively for both aspects of this for the hands-on approach and ready access to simple networking code. To finish off the term, after looking at things like network latency, I thought it’d be fun to do an activity built around attenuation of wireless signals.
Previously I’ve had students group up in pairs and have the Micro:bits send an image back and forth pixel by pixel. This allows for students to see when messages have not arrived as they will have missing pixels from their displays.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-04-19T14:02:52+00:00">
    <meta property="article:modified_time" content="2019-04-19T14:02:52+00:00">
    <meta property="article:tag" content="Microbit">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dowsing for Radio">
<meta name="twitter:description" content="Motivation
This term I&rsquo;ve been working through Data Representation and some Networks concepts with my Year 8 students. I used Micro:bits extensively for both aspects of this for the hands-on approach and ready access to simple networking code. To finish off the term, after looking at things like network latency, I thought it&rsquo;d be fun to do an activity built around attenuation of wireless signals.
Previously I&rsquo;ve had students group up in pairs and have the Micro:bits send an image back and forth pixel by pixel. This allows for students to see when messages have not arrived as they will have missing pixels from their displays.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "/post/"
    }
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Dowsing for Radio",
      "item": "/dowsing-for-radio/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Dowsing for Radio",
  "name": "Dowsing for Radio",
  "description": "Motivation This term I\u0026rsquo;ve been working through Data Representation and some Networks concepts with my Year 8 students. I used Micro:bits extensively for both aspects of this for the hands-on approach and ready access to simple networking code. To finish off the term, after looking at things like network latency, I thought it\u0026rsquo;d be fun to do an activity built around attenuation of wireless signals.\nPreviously I\u0026rsquo;ve had students group up in pairs and have the Micro:bits send an image back and forth pixel by pixel. This allows for students to see when messages have not arrived as they will have missing pixels from their displays.\n",
  "keywords": [
    "microbit"
  ],
  "articleBody": "Motivation This term I’ve been working through Data Representation and some Networks concepts with my Year 8 students. I used Micro:bits extensively for both aspects of this for the hands-on approach and ready access to simple networking code. To finish off the term, after looking at things like network latency, I thought it’d be fun to do an activity built around attenuation of wireless signals.\nPreviously I’ve had students group up in pairs and have the Micro:bits send an image back and forth pixel by pixel. This allows for students to see when messages have not arrived as they will have missing pixels from their displays.\nThis year, coming up to Easter I thought I’d do an egg hunt by measuring signal strength of “beacon” Micro:bits and using different methods to relay that to the user of a detector Micro:bit. I’ve been meaning to do this sort of activity for a while after seeing the Hot or Cold activity.\nI think it would be interesting to do an orienteering activity based on this at some point where students could have their Micro:bit collect data on the beacons they have found and report back for scoring at the end. I'm keeping this idea for our next orientation day activity with our incoming Year 6 students. Physical Design The beacon itself is just a Micro:bit powered by a battery periodically broadcasting a message. The only interesting thing I incorporated into the beacon is being able to change the signal strength so that some beacons are easier to find than others. I found that a strength between 0 and 3 was pretty good for what I wanted.\nMy initial designs for the detector simply used a horizontal line on the Micro:bit screen which moved up or down depending on the strength of received messages. It worked fine in a utilitarian kind of way, and since I only have so much space to store bigger housings, most students would use something like this.\nPKE Meter design created by Teletran (Deviantart)\nHowever, in the spirit of cheesy sci-fi I wanted to build a hand-held detector that had glowy lights and moving parts. Although I didn’t recognise it at the time, what I had in my head was the Psycho-Kinetic Energy (P.K.E.) Meter from Ghost Busters.\nAlthough I initially wanted to have acrylic arms which could be bottom-lit using RGB LEDs, I ended up just using MDF parts, and embedding a single RGB LED in the face of the housing. If I revisit the design later on I’ll see about making a fancier version, but I ran out of prototyping time for this design.\nAnother idea which would be good (and thinking about accessibility) is incorporating a piezo or larger speaker into the design so that there could be some audio as well as visual feedback on signal strength. I used a cheap USB power bank for the power supply, and the excellent DFRobot Micro:mate to break out the pins for my LED and servos. 1 - Low Signal 2 - Medium Signal 3 - Strong Signal Technical Stuff The signal strength (RSSI, measured in dBm) theoretically is measured from -255 to 0, with 0 being the strongest (MicroPython docs on using receive_full() with the Micro:bit). In my testing however, I rarely saw values outside of -30 to -100, so when converting the received signal strength into a percentage for use as an angle and hue, any readings outside of this space got compressed to the extremes.\nrssi = abs(rssi) - 30 if rssi \u003c 0: rssi = 0 elif rssi \u003e 70: rssi = 70 perc = rssi / 70 Signal readings were incredibly spiky taking only one reading at a time, so I tried out a rolling average which worked OK at 10 readings, and significantly better at 25 readings (with a 50ms delay between each reading). It introduced a delay in displaying signal readings, but stopping the jerky behaviour of the servos and flashing of the LED indicators was worth it.\nlast = [] keep_last = 25 # how long the rolling average should be ... last.append(perc) if len(last) \u003e keep_last: del last[0] perc_avg = sum(last) / len(last) Using the average could potentially be an issue if sitting between a pair of transmitters, but generally students moved around enough that it wasn't a problem of two equally strong signals interfering with the readings, and set the signal strength low enough that messages were not received beyond 3-4 meters, so judicious placement of beacons sorted this fairly well. Review Short range radio strength is quite finnicky, and so no matter how much fiddling I do with the code it will never work exactly how I want it due to interference, the direction of the antennas, and what I had for breakfast. However, I think the finished product works passably well, the physical design for the housing gives it a nice theatrical (if boxy) air, and it’s a fun activity for the kids to do while learning about some of the properties of wireless communication.\nIf anyone is interested in the code or laser cut designs, they are in my Microbit Github repo along with the other things I make.\nI got to test this out with one of my Year 8 classes before school broke up for the holidays, hiding seven beacons behind books in our library and giving teams of three students a detector for each student, the short author code of the book each beacon was behind, and five minutes to match the books up with their title or the Dewey number. They all had a blast so this will definitely be on my list of things to do later on as an engagement activity (even through we didn’t have the time to really dig into the details before break).\n",
  "wordCount" : "968",
  "inLanguage": "en",
  "datePublished": "2019-04-19T14:02:52.914Z",
  "dateModified": "2019-04-19T14:02:52.914Z",
  "author":{
    "@type": "Person",
    "name": "Rob"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/dowsing-for-radio/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Headtilt",
    "logo": {
      "@type": "ImageObject",
      "url": "/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="/" accesskey="h" title="Adjust your angle (Alt + H)">
                <img src="/images/headtilt.png" alt="" aria-label="logo"
                    height="30">Adjust your angle</a>
            <div class="logo-switches">
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="/post" title="posts">
                    <span><i class="fa-solid fa-pen-to-square"></i> posts</span>
                </a>
            </li>
            <li>
                <a href="/page/about/" title="about">
                    <span><i class="fa-solid fa-circle-info"></i> about</span>
                </a>
            </li>
            <li>
                <a href="/categories/" title="categories">
                    <span><i class="fa-solid fa-layer-group"></i> categories</span>
                </a>
            </li>
            <li>
                <a href="/tags/" title="tags">
                    <span><i class="fa-solid fa-tags"></i> tags</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Dowsing for Radio
    </h1>
    <div class="post-meta"><span title='2019-04-19 14:02:52.914 +0000 UTC'>Fri, Apr 19, 2019</span>&nbsp;·&nbsp;Rob

</div>
  </header> 
  <div class="post-content"><img loading="lazy" src="/images/pke/IMG_2246.jpg"><h2 id="motivation">Motivation<a hidden class="anchor" aria-hidden="true" href="#motivation">#</a></h2>
<p>This term I&rsquo;ve been working through Data Representation and some Networks concepts with my Year 8 students. I used Micro:bits extensively for both aspects of this for the hands-on approach and ready access to simple networking code. To finish off the term, after looking at things like network latency, I thought it&rsquo;d be fun to do an activity built around attenuation of wireless signals.</p>
<p>Previously I&rsquo;ve had students group up in pairs and have the Micro:bits send an image back and forth pixel by pixel. This allows for students to see when messages have not arrived as they will have missing pixels from their displays.</p>
<p>This year, coming up to Easter I thought I&rsquo;d do an egg hunt by measuring signal strength of &ldquo;beacon&rdquo; Micro:bits and using different methods to relay that to the user of a detector Micro:bit. I&rsquo;ve been meaning to do this sort of activity for a while after seeing the <a href="https://makecode.microbit.org/projects/hot-or-cold">Hot or Cold</a> activity.</p>
<div class="callout callout-info">
    <i class="fa-regular fa-lightbulb"></i>
    <div class="callout-content">
        
I think it would be interesting to do an orienteering activity based on this at some point where students could have their Micro:bit collect data on the beacons they have found and report back for scoring at the end. I'm keeping this idea for our next orientation day activity with our incoming Year 6 students.

    </div>
</div>

<style>
    .callout {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }

    .callout-info {
        background-color: #e7f3fe;
        border-color: #b3d4fc;
    }

    .callout i {
        margin-right: 10px;
        padding: 0.25em 0.5em;
        font-size: 1.5em;
    }

    .callout-content {
        flex-grow: 1;
    }
</style>
<h2 id="physical-design"> Physical Design<a hidden class="anchor" aria-hidden="true" href="#physical-design">#</a></h2>
<p>The beacon itself is just a Micro:bit powered by a battery periodically broadcasting a message. The only interesting thing I incorporated into the beacon is being able to change the signal strength so that some beacons are easier to find than others. I found that a strength between 0 and 3 was pretty good for what I wanted.</p>
<p>My initial designs for the detector simply used a horizontal line on the Micro:bit screen which moved up or down depending on the strength of received messages. It worked fine in a utilitarian kind of way, and since I only have so much space to store bigger housings, most students would use something like this.</p>
<img alt="PKE Meter - Teletran@Deviantart" loading="lazy" src="/images/pke/pke_meter_by_teletran.jpg"><p>PKE Meter design created by <a href="https://www.deviantart.com/teletran/art/PKE-meter-163025300">Teletran (Deviantart)</a></p>
<p>However, in the spirit of cheesy sci-fi I wanted to build a hand-held detector that had glowy lights and moving parts. Although I didn&rsquo;t recognise it at the time, what I had in my head was the Psycho-Kinetic Energy (P.K.E.) Meter from Ghost Busters.</p>
<p>Although I initially wanted to have acrylic arms which could be bottom-lit using RGB LEDs, I ended up just using MDF parts, and embedding a single RGB LED in the face of the housing. If I revisit the design later on I&rsquo;ll see about making a fancier version, but I ran out of prototyping time for this design.</p>
<div class="callout callout-info">
    <i class="fa-regular fa-lightbulb"></i>
    <div class="callout-content">
        
Another idea which would be good (and thinking about accessibility) is incorporating a piezo or larger speaker into the design so that there could be some audio as well as visual feedback on signal strength.

    </div>
</div>

<style>
    .callout {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }

    .callout-info {
        background-color: #e7f3fe;
        border-color: #b3d4fc;
    }

    .callout i {
        margin-right: 10px;
        padding: 0.25em 0.5em;
        font-size: 1.5em;
    }

    .callout-content {
        flex-grow: 1;
    }
</style>
<p>I used a cheap USB power bank for the power supply, and the excellent DFRobot Micro:mate to break out the pins for my LED and servos. </p>
<style>
    .image-gallery {
        display: flex;
        flex-wrap: wrap;
        gap: 1%;
        margin-left: -1% !important;
    }

    .image-gallery li {
        list-style: none;
        width: 19%;
        display: flex;
        flex-direction: column;
    }

    .image-gallery li a {
        text-align: center;
        text-decoration: none !important;
        color: #777;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        justify-content: space-between;
        box-shadow: none !important;
    }

    .image-gallery li a span {
        display: block;
        padding: 3px 0;
        white-space: normal;
        font-size: 0.8em;
    }

    .image-gallery li a img {
        width: 100%;
        display: block;
    }

     
    @media (max-width: 1200px) {
        .image-gallery li {
            width: 24%;
             
        }
    }

    @media (max-width: 992px) {
        .image-gallery li {
            width: 32%;
             
        }
    }

    @media (max-width: 768px) {
        .image-gallery li {
            width: 49%;
             
        }
    }

    @media (max-width: 576px) {
        .image-gallery li {
            width: 100%;
             
        }
    }
</style>


<ul class="image-gallery">
    <li>
        <a href="/gallery/dowsing/1%20-%20Low%20Signal.jpg" title="1 - Low Signal" class="lightbox-image">
            <img src="/gallery/dowsing/1%20-%20Low%20Signal.jpg" alt="1 - Low Signal" title="1 - Low Signal">
            <span>1 - Low Signal</span>
        </a>
    </li>
    <li>
        <a href="/gallery/dowsing/2%20-%20Medium%20Signal.jpg" title="2 - Medium Signal" class="lightbox-image">
            <img src="/gallery/dowsing/2%20-%20Medium%20Signal.jpg" alt="2 - Medium Signal" title="2 - Medium Signal">
            <span>2 - Medium Signal</span>
        </a>
    </li>
    <li>
        <a href="/gallery/dowsing/3%20-%20Strong%20Signal.jpg" title="3 - Strong Signal" class="lightbox-image">
            <img src="/gallery/dowsing/3%20-%20Strong%20Signal.jpg" alt="3 - Strong Signal" title="3 - Strong Signal">
            <span>3 - Strong Signal</span>
        </a>
    </li>
    
</ul>
<h2 id="technical-stuff">Technical Stuff<a hidden class="anchor" aria-hidden="true" href="#technical-stuff">#</a></h2>
<p>The signal strength (RSSI, measured in dBm) theoretically is measured from -255 to 0, with 0 being the strongest (<a href="https://microbit-micropython.readthedocs.io/en/latest/radio.html#radio.receive_full">MicroPython docs</a> on using receive_full() with the Micro:bit). In my testing however, I rarely saw values outside of -30 to -100, so when converting the received signal strength into a percentage for use as an angle and hue, any readings outside of this space got compressed to the extremes.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">rssi</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">rssi</span><span class="p">)</span> <span class="o">-</span> <span class="mi">30</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="n">rssi</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">rssi</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">  <span class="k">elif</span> <span class="n">rssi</span> <span class="o">&gt;</span> <span class="mi">70</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="n">rssi</span> <span class="o">=</span> <span class="mi">70</span>
</span></span><span class="line"><span class="cl">  <span class="n">perc</span> <span class="o">=</span> <span class="n">rssi</span> <span class="o">/</span> <span class="mi">70</span>
</span></span></code></pre></div><p>Signal readings were incredibly spiky taking only one reading at a time, so I tried out a rolling average which worked OK at 10 readings, and significantly better at 25 readings (with a 50ms delay between each reading). It introduced a delay in displaying signal readings, but stopping the jerky behaviour of the servos and flashing of the LED indicators was worth it.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl">  <span class="n">last</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">  <span class="n">keep_last</span> <span class="o">=</span> <span class="mi">25</span> <span class="c1"># how long the rolling average should be</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="n">last</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">perc</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">keep_last</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">      <span class="k">del</span> <span class="n">last</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">perc_avg</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">last</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">last</span><span class="p">)</span>
</span></span></code></pre></div><div class="callout callout-warning">
    <i class="fa-solid fa-asterisk"></i>
    <div class="callout-content">
        
Using the average could potentially be an issue if sitting between a pair of transmitters, but generally students moved around enough that it wasn't a problem of two equally strong signals interfering with the readings, and set the signal strength low enough that messages were not received beyond 3-4 meters, so judicious placement of beacons sorted this fairly well.

    </div>
</div>

<style>
    .callout {
        border: 1px solid #ccc;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        display: flex;
        align-items: center;
    }

    .callout-warning {
        background-color: #fff3cd;
        border-color: #ffeeba;
    }

    .callout i {
        margin-right: 10px;
        padding: 0.25em 0.5em;
        font-size: 1.5em;
    }

    .callout-content {
        flex-grow: 1;
    }
</style>
<h2 id="review">Review<a hidden class="anchor" aria-hidden="true" href="#review">#</a></h2>
<p>Short range radio strength is quite finnicky, and so no matter how much fiddling I do with the code it will never work exactly how I want it due to interference, the direction of the antennas, and what I had for breakfast. However, I think the finished product works passably well, the physical design for the housing gives it a nice theatrical (if boxy) air, and it&rsquo;s a fun activity for the kids to do while learning about some of the properties of wireless communication.</p>
<p>If anyone is interested in the code or laser cut designs, they are in my <a href="https://github.com/zarify/microbit/tree/master/Radio_Dowsing">Microbit Github repo</a> along with the other things I make.</p>
<p>I got to test this out with one of my Year 8 classes before school broke up for the holidays, hiding seven beacons behind books in our library and giving teams of three students a detector for each student, the short author code of the book each beacon was behind, and five minutes to match the books up with their title or the Dewey number. They all had a blast so this will definitely be on my list of things to do later on as an engagement activity (even through we didn&rsquo;t have the time to really dig into the details before break).</p>
<iframe width="640" height="1138" src="https://player.vimeo.com/video/331371137" frameborder="0" allow="autoplay; fullscreen" allowfullscreen="allowfullscreen" data-mce-fragment="1"></iframe>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="/tags/microbit/">Microbit</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>Rob Poulter</span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a><script type="text/javascript" src="/js/lightbox.js"></script>
<link rel="stylesheet" href="/css/lightbox.css">

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
