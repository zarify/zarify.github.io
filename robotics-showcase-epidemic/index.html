<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Micro:bit Epidemic - Headtilt</title><meta name="description" content="Last year when looking at wireless concepts with my Year 8 Digital&hellip;"><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://headtilt.me/robotics-showcase-epidemic/"><link rel="alternate" type="application/atom+xml" href="https://headtilt.me/feed.xml"><link rel="alternate" type="application/json" href="https://headtilt.me/feed.json"><meta name="twitter:card" content="summary"><meta name="twitter:site" content="@robpoulter"><meta name="twitter:title" content="Micro:bit Epidemic"><meta name="twitter:description" content="Last year when looking at wireless concepts with my Year 8 Digital&hellip;"><meta name="twitter:image" content="https://headtilt.me/media/posts/80/virus_splash.png"><link rel="shortcut icon" href="https://headtilt.me/media/website/favicon.ico" type="image/x-icon"><link rel="preload" href="https://fonts.googleapis.com/css?family=Heebo:400,500|Playfair+Display:400" as="font" crossorigin><link rel="stylesheet" href="https://headtilt.me/assets/css/style.css?v=7aaef5a7341c740e40570fe5042e66fa"><link rel="stylesheet" href="https://headtilt.me/assets/css/photoswipe.css?v=966dabfb3dfb423703bc6983e34f4ef2"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://headtilt.me/robotics-showcase-epidemic/"},"headline":"Micro:bit Epidemic","datePublished":"2020-05-25T05:51","dateModified":"2020-05-25T06:47","image":{"@type":"ImageObject","url":"https://headtilt.me/media/posts/80/virus_splash.png","height":800,"width":800},"description":"Last year when looking at wireless concepts with my Year 8 Digital&hellip;","author":{"@type":"Person","name":"Rob"},"publisher":{"@type":"Organization","name":"Rob","logo":{"@type":"ImageObject","url":"https://headtilt.me/media/website/slice1.png","height":78,"width":354}}}</script><script async src="https://headtilt.me/assets/js/lazysizes.min.js?v=739e7d27e1cbc58b1b2e6882674b8867"></script><link rel="stylesheet" href="https://headtilt.me/assets/css/prism.css?v=718e86b555366857a48cea2de2ecf136"></head><body><div class="container"><header class="js-top"><a class="logo" href="https://headtilt.me/"><img src="https://headtilt.me/media/website/slice1.png" alt="Headtilt"></a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle" aria-expanded="false">Menu</button><ul class="navbar__menu"><li><a href="https://headtilt.me/wag/ramble/" target="_self">Ramble</a></li><li><a href="https://headtilt.me/wag/classroom/" target="_self">Classroom</a></li><li><a href="https://headtilt.me/About/" target="_self">About</a></li></ul></nav></div></header><main><article class="post u-wrapper"><header class="hero"><p class="post__meta">By <a href="https://headtilt.me/authors/rob/" rel="author" title="Rob">Rob</a> Published on <time datetime="2020-05-25T05:51">May 25, 2020</time></p><h1 class="post__title">Micro:bit Epidemic</h1></header><div class="post__featured-image post__image--normal"><img src="https://headtilt.me/media/posts/80/responsive/virus_splash-xs.png" data-srcset="https://headtilt.me/media/posts/80/responsive/virus_splash-xs.png 300w ,https://headtilt.me/media/posts/80/responsive/virus_splash-sm.png 480w ,https://headtilt.me/media/posts/80/responsive/virus_splash-md.png 768w ,https://headtilt.me/media/posts/80/responsive/virus_splash-lg.png 1024w ,https://headtilt.me/media/posts/80/responsive/virus_splash-xl.png 1360w ,https://headtilt.me/media/posts/80/responsive/virus_splash-2xl.png 1600w ,https://headtilt.me/media/posts/80/responsive/virus_splash-sm2.png 375w" data-sizes="auto" height="800" width="800" alt="" class="lazyload blur-up"></div><div class="post__entry"><p>Last year when looking at wireless concepts with my Year 8 Digital Technologies students, I wrote a program for wireless beacons and laser cut a <a href="https://headtilt.me/dowsing-for-radio/">Ghostbusters style PKE Meter</a> with some servos and a RGB LED for students to go on a hunt in our library. It was a good opportunity to look at things like the range of wireless signals, interference due to obstruction of different materials, and noisy broadcast channels. The students quite enjoyed it and it was a nice excuse to get out of the classroom.</p><p>2020 has been the year of living with the global SARS-CoV2 pandemic, and there has been a lot of discussion about the various contact tracing apps which have been developed left and right (which is great fuel for my classes on ethics and data privacy!) and I figured I'd spin up a new idea for the activity on wireless networks and flip the contact tracing app on its head, using it to infect other devices instead of keep records of potentially risky contact.</p><p>The basic concept of the contact tracing apps (at least of the moderately sane variety) is this:</p><ul><li>Broadcast an ID (often randomised) via Bluetooth Low Energy</li><li>Monitor incoming beacon messages, and use the signal to determine approximate proximity and whether this falls within the threshhold of $DANGER_DISTANCE</li><li>Keep a record of IDs which have been in proximity for $DANGER_TIME</li><li>IDs are purged after some time period (21 days is thrown around a lot) which would cover the time taken to typically develop symptoms</li><li>In the event of someone testing positive for COVID-19 contacts could be uploaded to local health services to enable more efficient contact tracing (with the method for this varying by implementation)</li></ul><p>The typical values for $DANGER_DISTANCE and $DANGER_TIME have been around 2 meters and 15 minutes respectively.</p><h2>Using Micro:bits</h2><p>Since the Micro:bit has a Bluetooth radio and can easily monitor signal strength and signal device IDs, it was fairly straightforward to implement some code (written in Microsoft's MakeCode this time, whereas I used Python for the PKE meter).</p><p>I'd like to do up a version of this that uses a speaker as well for some audio feedback about symptom status - some bleeps and bloops for coughing perhaps, or even just for some basic tactile feedback of vibration from a piezo to alert students that their device is sick.</p><p>I've included links to the code and discussion of the algorithm further down the page.</p><h2>Video</h2><p>Here's a video of my first test run of more than a pair of clients. There's one mistake in my discussion as it plays where I say more than 10 infection messages in a 30 second period, which should be a 40 second period - since infection messages are broadcast every 2 seconds, it would make it hard to get infected otherwise!</p><p></p><div class="post__iframe"><iframe width="640" height="1138" src="https://player.vimeo.com/video/420545881" frameborder="0" allow="autoplay; fullscreen" allowfullscreen="allowfullscreen"></iframe></div><p></p><h2>The Code</h2><p> Since this section will be a bit lengthy, here are links to the code. I've tried to comment most of the important blocks so hopefully most of it will be pretty self-explanatory.</p><p><a href="https://makecode.microbit.org/27344-13737-35905-04849">MakeCode - Virus Client</a></p><p><a href="https://makecode.microbit.org/34820-54217-59128-00273">MakeCode - Virus Master</a></p><h3>Virus Master</h3><p>The virus master device is responsible for monitoring of the client devices, and also initial infection of a client device so that I have a known infection time and get an opportunity to prime students for the activity (which I'm planning on running twice - once unaware, and once with intentional physical distancing).</p><p>The code is pretty straightforward - it just monitors radio traffic and collects device IDs and infection messages to keep track of total and infected devices.</p><div class="gallery" data-is-empty="false" data-columns="2"><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/master_setup.png" data-size="306x151"><img src="https://headtilt.me/media/posts/80/gallery/master_setup-thumbnail.png" alt="" width="240" height="151"></a><figcaption class="gallery-description">Set the radio group and create arrays for keeping device IDs of nearby Micro:bits and infected devices.</figcaption></figure><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/master_discovery.png" data-size="781x298"><img src="https://headtilt.me/media/posts/80/gallery/master_discovery-thumbnail.png" alt="" width="240" height="240"></a><figcaption class="gallery-description">Incoming messages will either be discovery messages or infection messages. Capture device IDs and put into relevant arrays if not already present.</figcaption></figure><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/master_client_monitoring.png" data-size="812x342"><img src="https://headtilt.me/media/posts/80/gallery/master_client_monitoring-thumbnail.png" alt="" width="240" height="240"></a><figcaption class="gallery-description">Use the captured device IDs to report on number of devices seen and infected using A or B.</figcaption></figure><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/master_infection.png" data-size="839x204"><img src="https://headtilt.me/media/posts/80/gallery/master_infection-thumbnail.png" alt="" width="240" height="204"></a><figcaption class="gallery-description">Pick a random device ID to send an infection message to as Patient Zero.</figcaption></figure></div><h3>Virus Client</h3><p>The virus client maintains arrays of infected devices around itself based on the RSSI (signal strength) values of incoming messages. Each incoming message also contains the device ID of the sender, which can be used for determining whether enough infection messages have been received to merit being infected itself.</p><p>If sufficient time (40s in this case) passes without enough infection messages from a seen device, that device's info is purged from the lists. This has a couple of purposes:</p><ol><li>It keeps the idea of device lists easier to understand - if it's there it's infectious and close enough to be a problem</li><li>If it isn't there, we're preserving that device's privacy by not keeping its info on our device</li></ol><p>When devices are infected, they remain asymptomatic for 60 seconds, so only show the sad face on the screen after they've been merrily infecting other close devices for some time. </p><div class="gallery" data-is-empty="false" data-columns="2"><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/client_setup.png" data-size="355x440"><img src="https://headtilt.me/media/posts/80/gallery/client_setup-thumbnail.png" alt="" width="240" height="240"></a><figcaption class="gallery-description">The client needs to maintain arrays of other devices it has seen which are broadcasting infected messages, when it first saw an infected device, and how many messages it has seen. It also needs to know if it is infectious and displaying symptoms.</figcaption></figure><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/client_forever.png" data-size="814x473"><img src="https://headtilt.me/media/posts/80/gallery/client_forever-thumbnail.png" alt="" width="240" height="240"></a><figcaption class="gallery-description">The clients broadcast discovery messages intended for the master device. If they are infected, they broadcast infect messages, and use the screen to displays whether or not they are symptomatic. Contacts are also pruned when they fall out of range for the infection window.</figcaption></figure><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/client_contact_monitoring.png" data-size="889x832"><img src="https://headtilt.me/media/posts/80/gallery/client_contact_monitoring-thumbnail.png" alt="" width="240" height="240"></a><figcaption class="gallery-description">When radio packets are received, the client needs to determine if the device has been seen before, if the signal is strong enough to merit contributing to infection, and whether enough contact has occured to infect this device. This also listens for the master device to see if an infection message refers to this device ID.</figcaption></figure><figure class="gallery__item"><a href="https://headtilt.me/media/posts/80/gallery/client_pruning.png" data-size="885x415"><img src="https://headtilt.me/media/posts/80/gallery/client_pruning-thumbnail.png" alt="" width="240" height="240"></a><figcaption class="gallery-description">I could probably get away without pruning and just maintain data for every device seen, but this keeps the list of infected devices easy to understand. If it's in the array, it's something to worry about. This also stays true to the idea of not keeping identifying data for devices which are not relevant.</figcaption></figure></div></div><footer class="post__footer"><div class="post__last-updated">This article was updated on May 25, 2020</div><div class="post__footer__col"><ul class="post__tag"><li><a href="https://headtilt.me/wag/classroom/">classroom</a></li><li><a href="https://headtilt.me/wag/compsci/">compsci</a></li><li><a href="https://headtilt.me/wag/microbit/">microbit</a></li><li><a href="https://headtilt.me/wag/robotics/">robotics</a></li></ul></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://headtilt.me/year-10s-sentiment-analysis/" class="inverse" rel="prev">Year 10s: Sentiment Analysis</a></h5></div></nav></footer></article></main><footer class="footer"><div class="footer__copyright">Powered by inertia.</div><div class="footer__social"><a href="https://twitter.com/robpoulter" aria-label="Twitter"><svg class="icon"><use xlink:href="https://headtilt.me/assets/svg/svg-map.svg#twitter"/></svg></a></div></footer></div><script defer="defer" src="https://code.jquery.com/jquery-3.2.1.min.js" integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin="anonymous"></script><script defer="defer" src="https://headtilt.me/assets/js/scripts.min.js?v=f503b0ac46db9f99180b3b9f932c7f9a"></script><script defer="defer" src="https://headtilt.me/assets/js/photoswipe.min.js?v=9c62086e50d89a9b6a29389a70ee0d65"></script><script defer="defer" src="https://headtilt.me/assets/js/photoswipe-ui-default.min.js?v=aafb02c13ce2b295ff34a8ac0db67cbb"></script><script>var initPhotoSwipeFromDOM=function(gallerySelector){var parseThumbnailElements=function(el){var thumbElements=el.childNodes,numNodes=thumbElements.length,items=[],figureEl,linkEl,size,item;for(var i=0;i<numNodes;i++){figureEl=thumbElements[i];if(figureEl.nodeType!==1){continue;}
              linkEl=figureEl.children[0];size=linkEl.getAttribute('data-size').split('x');item={src:linkEl.getAttribute('href'),w:parseInt(size[0],10),h:parseInt(size[1],10)};if(figureEl.children.length>1){item.title=figureEl.children[1].innerHTML;}
              if(linkEl.children.length>0){item.msrc=linkEl.children[0].getAttribute('src');}
              item.el=figureEl;items.push(item);}
              return items;};var closest=function closest(el,fn){return el&&(fn(el)?el:closest(el.parentNode,fn));};var onThumbnailsClick=function(e){e=e||window.event;e.preventDefault?e.preventDefault():e.returnValue=false;var eTarget=e.target||e.srcElement;var clickedListItem=closest(eTarget,function(el){return(el.tagName&&el.tagName.toUpperCase()==='FIGURE');});if(!clickedListItem){return;}
              var clickedGallery=clickedListItem.parentNode,childNodes=clickedListItem.parentNode.childNodes,numChildNodes=childNodes.length,nodeIndex=0,index;for(var i=0;i<numChildNodes;i++){if(childNodes[i].nodeType!==1){continue;}
              if(childNodes[i]===clickedListItem){index=nodeIndex;break;}
              nodeIndex++;}
              if(index>=0){openPhotoSwipe(index,clickedGallery);}
              return false;};var photoswipeParseHash=function(){var hash=window.location.hash.substring(1),params={};if(hash.length<5){return params;}
              var vars=hash.split('&');for(var i=0;i<vars.length;i++){if(!vars[i]){continue;}
              var pair=vars[i].split('=');if(pair.length<2){continue;}
              params[pair[0]]=pair[1];}
              if(params.gid){params.gid=parseInt(params.gid,10);}
              return params;};var openPhotoSwipe=function(index,galleryElement,disableAnimation,fromURL){var pswpElement=document.querySelectorAll('.pswp')[0],gallery,options,items;items=parseThumbnailElements(galleryElement);options={galleryUID:galleryElement.getAttribute('data-pswp-uid'),getThumbBoundsFn:function(index){var thumbnail=items[index].el.getElementsByTagName('img')[0],pageYScroll=window.pageYOffset||document.documentElement.scrollTop,rect=thumbnail.getBoundingClientRect();return{x:rect.left,y:rect.top+pageYScroll,w:rect.width};},
              mainClass:'',
              hideAnimationDuration:200,
              showAnimationDuration:0,
              bgOpacity: 0.7,
              showHideOpacity:true,
              closeOnScroll: true,
              arrowKeys: true,
              closeEl: true,
              captionEl: true,
              fullscreenEl: true,
              zoomEl: true,
              shareEl: true,
              counterEl: true,
              arrowEl: true,
              preloaderEl: true
              };if(fromURL){if(options.galleryPIDs){for(var j=0;j<items.length;j++){if(items[j].pid==index){options.index=j;break;}}}else{options.index=parseInt(index,10)-1;}}else{options.index=parseInt(index,10);}
              if(isNaN(options.index)){return;}
              if(disableAnimation){options.showAnimationDuration=0;}
              gallery=new PhotoSwipe(pswpElement,PhotoSwipeUI_Default,items,options);gallery.init();gallery.options.escKey=true;};var galleryElements=document.querySelectorAll(gallerySelector);for(var i=0,l=galleryElements.length;i<l;i++){galleryElements[i].setAttribute('data-pswp-uid',i+1);galleryElements[i].onclick=onThumbnailsClick;}
              var hashData=photoswipeParseHash();if(hashData.pid&&hashData.gid){openPhotoSwipe(hashData.pid,galleryElements[hashData.gid-1],true,true);}};initPhotoSwipeFromDOM('.gallery');</script><div class="pswp" tabindex="-1" role="dialog" aria-hidden="true"><div class="pswp__bg"></div><div class="pswp__scroll-wrap"><div class="pswp__container"><div class="pswp__item"></div><div class="pswp__item"></div><div class="pswp__item"></div></div><div class="pswp__ui pswp__ui--hidden"><div class="pswp__top-bar"><div class="pswp__counter"></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button> <button class="pswp__button pswp__button--share" title="Share"></button> <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button> <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class="pswp__preloader"><div class="pswp__preloader__icn"><div class="pswp__preloader__cut"><div class="pswp__preloader__donut"></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class="pswp__share-tooltip"></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button> <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class="pswp__caption"><div class="pswp__caption__center"></div></div></div></div></div><script>(function() {
    		var script = document.createElement('script');
    		window.counter = 'https://headtilt_me.goatcounter.com/count'
    		script.async = 1;
    		script.src = '//gc.zgo.at/count.js';
    
    		var ins = document.getElementsByTagName('script')[0];
    		ins.parentNode.insertBefore(script, ins)
    	})();</script><script defer="defer" src="https://headtilt.me/assets/js/prism.js?v=afcf02720f838e992a12336758017bcf"></script></body></html>